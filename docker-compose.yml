# c2025-12-09-full-app-english\docker-compose.yml

# --- PHáº¦N 1: GLOBAL SETTINGS (CÃ€I Äáº¶T CHUNG) ---

# Version: XÃ¡c Ä‘á»‹nh 'grammar' (ngá»¯ phÃ¡p) mÃ  file nÃ y sá»­ dá»¥ng.
# Version 3.8 lÃ  báº£n stable (á»•n Ä‘á»‹nh) vÃ  phá»• biáº¿n nháº¥t hiá»‡n nay.
version: "3.8"

# --- PHáº¦N 2: SERVICES (CÃC á»¨NG Dá»¤NG Cáº¦N CHáº Y) ---
# Services lÃ  trÃ¡i tim cá»§a file. NÆ¡i báº¡n list ra cÃ¡c 'app' muá»‘n cháº¡y.
services:
  # === SERVICE 1: DATABASE (POSTGRESQL) ===
  postgres:
    # 1. Image (Source Code):
    # - 'postgres': TÃªn pháº§n má»m trÃªn Docker Hub.
    # - ':15-alpine': Tag phiÃªn báº£n.
    #   + '15': Version chÃ­nh.
    #   + 'alpine': LÃ  há»‡ Ä‘iá»u hÃ nh Linux siÃªu nhá» (chá»‰ ~5MB), giÃºp container nháº¹ vÃ  báº£o máº­t hÆ¡n.
    image: postgres:15-alpine

    # 2. Container Name (Äá»‹nh danh):
    # - Náº¿u khÃ´ng Ä‘áº·t, Docker sáº½ tá»± random tÃªn (vd: project_postgres_1).
    # - Äáº·t tÃªn cá»‘ Ä‘á»‹nh 'vocab_db' giÃºp báº¡n dá»… gÃµ lá»‡nh (CLI) sau nÃ y.
    container_name: vocab_db

    # 3. Environment Variables (Biáº¿n mÃ´i trÆ°á»ng):
    # - ÄÃ¢y lÃ  cÃ¡ch ta 'inject' (tiÃªm) cáº¥u hÃ¬nh vÃ o trong container lÃºc nÃ³ khá»Ÿi Ä‘á»™ng (runtime).
    # - CÃ¡c biáº¿n báº¯t Ä‘áº§u báº±ng 'POSTGRES_...' lÃ  quy Ä‘á»‹nh riÃªng cá»§a image Postgres.
    environment:
      POSTGRES_USER: myuser # Táº¡o user máº·c Ä‘á»‹nh cÃ³ quyá»n cao nháº¥t (superuser)
      POSTGRES_PASSWORD: mypassword # Set máº­t kháº©u cho user Ä‘Ã³
      POSTGRES_DB: vocab_db # Tá»± Ä‘á»™ng táº¡o sáºµn 1 database rá»—ng tÃªn lÃ  'vocab_db'

    # 4. Ports Mapping (Ãnh xáº¡ cá»•ng - Quan trá»ng!):
    # - CÃº phÃ¡p: "HOST_PORT : CONTAINER_PORT" (NgoÃ i : Trong).
    # - "5432" (TrÃ¡i): Cá»•ng trÃªn mÃ¡y tÃ­nh cá»§a báº¡n (Localhost).
    # - "5432" (Pháº£i): Cá»•ng máº·c Ä‘á»‹nh mÃ  Postgres láº¯ng nghe bÃªn trong container.
    # -> Ã nghÄ©a: Báº¥t cá»© ai gÃµ vÃ o 'localhost:5432' trÃªn mÃ¡y báº¡n sáº½ Ä‘Æ°á»£c 'tunnel' (Ä‘i Ä‘Æ°á»ng háº§m) tháº³ng vÃ o database.
    ports:
      - "5433:5432"  # ğŸ‘ˆ Sá»­a 5432 thÃ nh 5433 (Cá»•ng ngoÃ i mÃ¡y tháº­t : Cá»•ng trong docker)

    # 5. Volumes (LÆ°u trá»¯ dá»¯ liá»‡u):
    # - CÃº phÃ¡p: "VOLUME_NAME : CONTAINER_PATH"
    # - 'postgres_data': TÃªn cÃ¡i 'kÃ©t sáº¯t' (volume) do Docker quáº£n lÃ½.
    # - '/var/lib/postgresql/data': ÄÆ°á»ng dáº«n báº¯t buá»™c nÆ¡i Postgres lÆ°u file dá»¯ liá»‡u bÃªn trong.
    # -> Ã nghÄ©a: Sync (Ä‘á»“ng bá»™) dá»¯ liá»‡u tá»« trong ra ngoÃ i. Container cháº¿t, data váº«n cÃ²n á»Ÿ 'postgres_data'.
    volumes:
      - postgres_data:/var/lib/postgresql/data

    # 6. Restart Policy (CÆ¡ cháº¿ tá»± phá»¥c há»“i):
    # - 'always': Náº¿u container bá»‹ crash (lá»—i) hoáº·c mÃ¡y tÃ­nh khá»Ÿi Ä‘á»™ng láº¡i,
    #   Docker sáº½ tá»± Ä‘á»™ng báº­t nÃ³ dáº­y. Giá»¯ cho service luÃ´n 'Alive'.
    restart: always

  # === SERVICE 2: REDIS (CACHE / QUEUE) ===
  redis:
    # DÃ¹ng image redis báº£n nháº¹ nháº¥t (alpine)
    image: redis:alpine

    # Äáº·t tÃªn Ä‘á»ƒ dá»… quáº£n lÃ½
    container_name: vocab_redis

    # Mapping cá»•ng Redis.
    # Cá»•ng 6379 lÃ  cá»•ng chuáº©n cá»§a Redis.
    ports:
      - "6379:6379"

    # Tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng láº¡i náº¿u cÃ³ sá»± cá»‘
    restart: always

# --- PHáº¦N 3: VOLUMES DECLARATION (KHAI BÃO KHO CHá»¨A) ---
# Báº¡n Ä‘Ã£ dÃ¹ng 'postgres_data' á»Ÿ trÃªn, nÃªn báº¡n pháº£i Ä‘Äƒng kÃ½ nÃ³ á»Ÿ Ä‘Ã¢y.
volumes:
  postgres_data:
    # Máº·c Ä‘á»‹nh Docker sáº½ táº¡o volume nÃ y á»Ÿ sÃ¢u trong há»‡ thá»‘ng file cá»§a Docker
    # (thÆ°á»ng lÃ  /var/lib/docker/volumes/...)
