{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/lib/api.ts"],"sourcesContent":["// apps/frontend/lib/api.ts\r\nimport axios from 'axios';\r\n\r\n// 1. Láº¥y Ä‘á»‹a chá»‰ tá»« biáº¿n mÃ´i trÆ°á»ng (Æ¯u tiÃªn) hoáº·c máº·c Ä‘á»‹nh vá» Localhost\r\nexport const API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://localhost:5000';\r\n\r\n// 2. Táº¡o má»™t instance axios dÃ¹ng chung cho cáº£ app\r\nconst api = axios.create({\r\n  baseURL: API_URL,\r\n  withCredentials: true, // Tá»± Ä‘á»™ng gá»­i cookie (token) Ä‘i kÃ¨m\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\nexport default api;"],"names":[],"mappings":"AAAA,2BAA2B;;;;;;;AAC3B;;AAGO,MAAM,UAAU,8DAAmC;AAE1D,kDAAkD;AAClD,MAAM,MAAM,gJAAK,CAAC,MAAM,CAAC;IACvB,SAAS;IACT,iBAAiB;IACjB,SAAS;QACP,gBAAgB;IAClB;AACF;uCAEe"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/contexts/AuthContext.tsx"],"sourcesContent":["// apps/frontend/contexts/AuthContext.tsx\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport api from '@/lib/api'; // Import api\r\n\r\ninterface User {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  avatar?: string;\r\n  googleApiKey?: string;\r\n  googleCx?: string;\r\n  azureSpeechKey?: string;\r\n  azureSpeechRegion?: string;\r\n  geminiApiKey?: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  token: string | null;\r\n  login: (email: string, password: string) => Promise<void>;\r\n  register: (email: string, password: string, name?: string) => Promise<void>;\r\n  logout: () => void;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Load token from localStorage or cookie on mount\r\n  useEffect(() => {\r\n    let savedToken = localStorage.getItem('token');\r\n\r\n    // Náº¿u khÃ´ng cÃ³ trong localStorage, thá»­ láº¥y tá»« cookie\r\n    if (!savedToken) {\r\n      const cookies = document.cookie.split(';');\r\n      const tokenCookie = cookies.find(c => c.trim().startsWith('token='));\r\n      if (tokenCookie) {\r\n        savedToken = tokenCookie.split('=')[1];\r\n        // LÆ°u láº¡i vÃ o localStorage Ä‘á»ƒ sync\r\n        localStorage.setItem('token', savedToken);\r\n      }\r\n    }\r\n\r\n    if (savedToken) {\r\n      setToken(savedToken);\r\n      fetchUser(savedToken);\r\n    } else {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch user info\r\n  const fetchUser = async (authToken: string) => {\r\n    try {\r\n      const response = await api.get('/auth/me', {\r\n        headers: { Authorization: `Bearer ${authToken}` },\r\n      });\r\n      setUser(response.data);\r\n    } catch (error) {\r\n      console.error('Failed to fetch user:', error);\r\n      localStorage.removeItem('token');\r\n      // XÃ³a cookie cÅ©\r\n      document.cookie = 'token=; path=/; max-age=0; SameSite=None; Secure';\r\n      setToken(null);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Login\r\n  const login = async (email: string, password: string) => {\r\n    const response = await api.post('/auth/login', {\r\n      email,\r\n      password,\r\n    });\r\n    const { token: newToken, user: newUser } = response.data;\r\n\r\n    localStorage.setItem('token', newToken);\r\n\r\n    // ðŸ‘‡ QUAN TRá»ŒNG: ThÃªm SameSite=None; Secure Ä‘á»ƒ Extension dÃ¹ng Ä‘Æ°á»£c Cookie nÃ y\r\n    document.cookie = `token=${newToken}; path=/; max-age=604800; SameSite=None; Secure`;\r\n\r\n    setToken(newToken);\r\n    setUser(newUser);\r\n  };\r\n\r\n  // Register\r\n  const register = async (email: string, password: string, name?: string) => {\r\n    const response = await api.post('/auth/register', {\r\n      email,\r\n      password,\r\n      name,\r\n    });\r\n    const { token: newToken, user: newUser } = response.data;\r\n\r\n    localStorage.setItem('token', newToken);\r\n\r\n    // ðŸ‘‡ QUAN TRá»ŒNG: ThÃªm SameSite=None; Secure\r\n    document.cookie = `token=${newToken}; path=/; max-age=604800; SameSite=None; Secure`;\r\n\r\n    setToken(newToken);\r\n    setUser(newUser);\r\n  };\r\n\r\n  // Logout\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    // XÃ³a cookie\r\n    document.cookie = 'token=; path=/; max-age=0; SameSite=None; Secure';\r\n    setToken(null);\r\n    setUser(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, token, login, register, logout, isLoading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}"],"names":[],"mappings":"AAAA,yCAAyC;;;;;;;;AAGzC;AACA,yLAA6B,aAAa;AAH1C;;;;AA0BA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,kDAAkD;IAClD,IAAA,kNAAS,EAAC;QACR,IAAI,aAAa,aAAa,OAAO,CAAC;QAEtC,qDAAqD;QACrD,IAAI,CAAC,YAAY;YACf,MAAM,UAAU,SAAS,MAAM,CAAC,KAAK,CAAC;YACtC,MAAM,cAAc,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,UAAU,CAAC;YAC1D,IAAI,aAAa;gBACf,aAAa,YAAY,KAAK,CAAC,IAAI,CAAC,EAAE;gBACtC,mCAAmC;gBACnC,aAAa,OAAO,CAAC,SAAS;YAChC;QACF;QAEA,IAAI,YAAY;YACd,SAAS;YACT,UAAU;QACZ,OAAO;YACL,aAAa;QACf;IACF,GAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,OAAO;QACvB,IAAI;YACF,MAAM,WAAW,MAAM,qHAAG,CAAC,GAAG,CAAC,YAAY;gBACzC,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,WAAW;gBAAC;YAClD;YACA,QAAQ,SAAS,IAAI;QACvB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;YACvC,aAAa,UAAU,CAAC;YACxB,gBAAgB;YAChB,SAAS,MAAM,GAAG;YAClB,SAAS;QACX,SAAU;YACR,aAAa;QACf;IACF;IAEA,QAAQ;IACR,MAAM,QAAQ,OAAO,OAAe;QAClC,MAAM,WAAW,MAAM,qHAAG,CAAC,IAAI,CAAC,eAAe;YAC7C;YACA;QACF;QACA,MAAM,EAAE,OAAO,QAAQ,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,IAAI;QAExD,aAAa,OAAO,CAAC,SAAS;QAE9B,8EAA8E;QAC9E,SAAS,MAAM,GAAG,CAAC,MAAM,EAAE,SAAS,+CAA+C,CAAC;QAEpF,SAAS;QACT,QAAQ;IACV;IAEA,WAAW;IACX,MAAM,WAAW,OAAO,OAAe,UAAkB;QACvD,MAAM,WAAW,MAAM,qHAAG,CAAC,IAAI,CAAC,kBAAkB;YAChD;YACA;YACA;QACF;QACA,MAAM,EAAE,OAAO,QAAQ,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,IAAI;QAExD,aAAa,OAAO,CAAC,SAAS;QAE9B,4CAA4C;QAC5C,SAAS,MAAM,GAAG,CAAC,MAAM,EAAE,SAAS,+CAA+C,CAAC;QAEpF,SAAS;QACT,QAAQ;IACV;IAEA,SAAS;IACT,MAAM,SAAS;QACb,aAAa,UAAU,CAAC;QACxB,aAAa;QACb,SAAS,MAAM,GAAG;QAClB,SAAS;QACT,QAAQ;IACV;IAEA,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAO;YAAO;YAAU;YAAQ;QAAU;kBAC5E;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}