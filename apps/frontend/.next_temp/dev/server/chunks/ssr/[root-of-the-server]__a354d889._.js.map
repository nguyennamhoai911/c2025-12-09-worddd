{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/hooks/vocabulary/useVocabData.ts"],"sourcesContent":["\r\nimport { useState, useCallback, useEffect, useRef } from \"react\";\r\nimport api from \"@/lib/api\"; // Import api\r\n\r\n// --- INTERFACES ---\r\nexport interface VocabItem {\r\n  id: string;\r\n  word: string;\r\n  topic?: string | null;\r\n  partOfSpeech?: string | null;\r\n  pronunciation?: string | null;\r\n  meaning?: string | null;\r\n  example?: string | null;\r\n  relatedWords?: string | null;\r\n  occurrence: number;\r\n  isStarred: boolean;\r\n  pronunciationScores: number[];\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface FilterState {\r\n  word: string;\r\n  topic: string;\r\n  partOfSpeech: string;\r\n  meaning: string;\r\n}\r\n\r\nexport interface SortState {\r\n  key: string;\r\n  direction: \"asc\" | \"desc\";\r\n}\r\n\r\nconst useVocabData = (token: string | null) => {\r\n  const [vocabs, setVocabs] = useState<VocabItem[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [page, setPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [showStarredOnly, setShowStarredOnly] = useState(false);\r\n\r\n  const [filters, setFilters] = useState<FilterState>({\r\n    word: \"\",\r\n    topic: \"\",\r\n    partOfSpeech: \"\",\r\n    meaning: \"\",\r\n  });\r\n\r\n  const [sortConfig, setSortConfig] = useState<SortState>({\r\n    key: \"updatedAt\",\r\n    direction: \"desc\",\r\n  });\r\n\r\n  const [columnOrder, setColumnOrder] = useState<string[]>([\r\n    \"star\",\r\n    \"updatedAt\",\r\n    \"topic\",\r\n    \"word\",\r\n    \"pronunciation\",\r\n    \"meaning\",\r\n    \"example\",\r\n    \"relatedWords\",\r\n    \"occurrence\",\r\n    \"score\",\r\n    \"actions\",\r\n  ]);\r\n  const [draggedCol, setDraggedCol] = useState<string | null>(null);\r\n\r\n  const debounceRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const fetchVocabs = useCallback(\r\n    async (\r\n      pageNum = 1,\r\n      currentFilters = filters,\r\n      currentSort = sortConfig,\r\n      starred = showStarredOnly\r\n    ) => {\r\n      if (!token) return;\r\n      setLoading(true);\r\n      try {\r\n        const params: any = {\r\n          page: pageNum,\r\n          limit: 20,\r\n          ...currentFilters,\r\n          sortBy: currentSort.key,\r\n          sortOrder: currentSort.direction,\r\n        };\r\n        if (starred) params.isStarred = \"true\";\r\n        const res = await api.get(\"/vocabulary\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n          params: params,\r\n        });\r\n        setVocabs(res.data.data);\r\n        setTotalPages(res.data.meta.lastPage);\r\n        setPage(res.data.meta.page);\r\n      } catch (error) {\r\n        console.error(\"Fetch error:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [token, filters, sortConfig, showStarredOnly]\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchVocabs();\r\n  }, [fetchVocabs]);\r\n  \r\n  const handleFilterChange = (field: keyof FilterState, value: string) => {\r\n    const newFilters = { ...filters, [field]: value };\r\n    setFilters(newFilters);\r\n    if (debounceRef.current) clearTimeout(debounceRef.current);\r\n    debounceRef.current = setTimeout(\r\n      () => fetchVocabs(1, newFilters, sortConfig),\r\n      500\r\n    );\r\n  };\r\n\r\n  const handleSort = (key: string) => {\r\n    let direction: \"asc\" | \"desc\" = \"asc\";\r\n    if (sortConfig.key === key && sortConfig.direction === \"asc\")\r\n      direction = \"desc\";\r\n    const newSortConfig = { key, direction };\r\n    setSortConfig(newSortConfig);\r\n    fetchVocabs(1, filters, newSortConfig);\r\n  };\r\n\r\n  const handleToggleStar = async (\r\n    id: string,\r\n    currentStatus: boolean,\r\n    e?: React.MouseEvent\r\n  ) => {\r\n    if (e) e.stopPropagation();\r\n    \r\n    // Optimistic update\r\n    const toggleFunc = (list: VocabItem[]) =>\r\n    list.map((item) =>\r\n      item.id === id ? { ...item, isStarred: !currentStatus } : item\r\n    );\r\n    setVocabs(toggleFunc);\r\n\r\n    try {\r\n      await api.patch(\r\n        `/vocabulary/${id}`,\r\n        { isStarred: !currentStatus },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Failed to star\", error);\r\n      // Revert on failure\r\n      setVocabs((prev) => \r\n        prev.map((item) =>\r\n          item.id === id ? { ...item, isStarred: currentStatus } : item\r\n        )\r\n      );\r\n    }\r\n  };\r\n\r\n  const triggerInteraction = async (vocab: VocabItem) => {\r\n    try {\r\n      const newOccurrence = (vocab.occurrence || 0) + 1;\r\n      const newTime = new Date().toISOString();\r\n      \r\n      // Optimistic update\r\n      setVocabs((prev) =>\r\n        prev.map((v) =>\r\n          v.id === vocab.id\r\n            ? { ...v, occurrence: newOccurrence, updatedAt: newTime }\r\n            : v\r\n        )\r\n      );\r\n      \r\n      await api.patch(\r\n        `/vocabulary/${vocab.id}`,\r\n        { occurrence: newOccurrence },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n    } catch (e) {\r\n      console.error(\"Interaction update failed\", e);\r\n       // Revert on failure\r\n       setVocabs((prev) =>\r\n       prev.map((v) =>\r\n         v.id === vocab.id\r\n           ? { ...v, occurrence: vocab.occurrence, updatedAt: vocab.updatedAt }\r\n           : v\r\n       )\r\n     );\r\n    }\r\n  };\r\n\r\n  const handleDragStart = (e: React.DragEvent, colId: string) => {\r\n    setDraggedCol(colId);\r\n    e.dataTransfer.effectAllowed = \"move\";\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent, colId: string) => {\r\n    e.preventDefault();\r\n    if (!draggedCol || draggedCol === colId) return;\r\n    const newOrder = [...columnOrder];\r\n    const draggedIdx = newOrder.indexOf(draggedCol);\r\n    const targetIdx = newOrder.indexOf(colId);\r\n    if (draggedIdx !== -1 && targetIdx !== -1) {\r\n      newOrder.splice(draggedIdx, 1);\r\n      newOrder.splice(targetIdx, 0, draggedCol);\r\n      setColumnOrder(newOrder);\r\n    }\r\n  };\r\n  \r\n  const handleDragEnd = () => {\r\n    setDraggedCol(null);\r\n  };\r\n\r\n  return {\r\n    vocabs,\r\n    loading,\r\n    page,\r\n    setPage,\r\n    totalPages,\r\n    showStarredOnly,\r\n    setShowStarredOnly,\r\n    filters,\r\n    sortConfig,\r\n    columnOrder,\r\n    draggedCol,\r\n    fetchVocabs,\r\n    handleFilterChange,\r\n    handleSort,\r\n    handleToggleStar,\r\n    triggerInteraction,\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnd,\r\n  };\r\n};\r\n\r\nexport default useVocabData;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/hooks/vocabulary/useVocabModals.ts"],"sourcesContent":["\r\nimport { useState, useRef } from \"react\";\r\nimport api from \"@/lib/api\"; // Import api for backend calls\r\nimport axios from \"axios\"; // Keep for external APIs (DictionaryAPI, Translate)\r\nimport { VocabItem } from \"./useVocabData\";\r\n\r\nexport interface VocabFormData {\r\n  word: string;\r\n  meaning: string;\r\n  example: string;\r\n  topic: string;\r\n  partOfSpeech: string;\r\n  relatedWords: string;\r\n  pronunciation: string;\r\n}\r\n\r\nconst useVocabModals = (\r\n  token: string | null,\r\n  fetchVocabs: (page?: number) => void\r\n) => {\r\n  const [selectedVocab, setSelectedVocab] = useState<VocabItem | null>(null);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isAutoFilling, setIsAutoFilling] = useState(false);\r\n  const [formData, setFormData] = useState<VocabFormData>({\r\n    word: \"\",\r\n    meaning: \"\",\r\n    example: \"\",\r\n    topic: \"\",\r\n    partOfSpeech: \"\",\r\n    relatedWords: \"\",\r\n    pronunciation: \"\",\r\n  });\r\n\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n\r\n  const triggerInteraction = async (vocab: VocabItem) => {\r\n    try {\r\n      const newOccurrence = (vocab.occurrence || 0) + 1;\r\n      await api.patch(\r\n        `/vocabulary/${vocab.id}`,\r\n        { occurrence: newOccurrence },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n    } catch (e) {\r\n      console.error(\"Interaction update failed\", e);\r\n    }\r\n  };\r\n\r\n  const handleRowClick = (vocab: VocabItem) => {\r\n    setSelectedVocab(vocab);\r\n    setFormData({\r\n      word: vocab.word,\r\n      meaning: vocab.meaning || \"\",\r\n      example: vocab.example || \"\",\r\n      topic: vocab.topic || \"\",\r\n      partOfSpeech: vocab.partOfSpeech || \"\",\r\n      relatedWords: vocab.relatedWords || \"\",\r\n      pronunciation: vocab.pronunciation || \"\",\r\n    });\r\n    setIsModalOpen(true);\r\n    triggerInteraction(vocab);\r\n  };\r\n\r\n  const fetchAutoFillData = async (word: string) => {\r\n    if (!word) return null;\r\n    setIsAutoFilling(true);\r\n    try {\r\n      const dictPromise = axios\r\n        .get(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`)\r\n        .catch(() => null);\r\n\r\n      const translatePromise = axios\r\n        .get(\r\n          `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(\r\n            word\r\n          )}`\r\n        )\r\n        .catch(() => null);\r\n\r\n      const [dictRes, transRes] = await Promise.all([\r\n        dictPromise,\r\n        translatePromise,\r\n      ]);\r\n\r\n      let newData: Partial<VocabFormData> = { word: word };\r\n\r\n      if (dictRes && dictRes.data && dictRes.data[0]) {\r\n        const entry = dictRes.data[0];\r\n        if (entry.phonetic) newData.pronunciation = entry.phonetic;\r\n        else if (entry.phonetics && entry.phonetics.length > 0) {\r\n          const p = entry.phonetics.find((x: any) => x.text && x.audio);\r\n          newData.pronunciation = p ? p.text : entry.phonetics[0].text;\r\n        }\r\n        if (entry.meanings && entry.meanings.length > 0) {\r\n          const meaning = entry.meanings[0];\r\n          newData.partOfSpeech = meaning.partOfSpeech;\r\n          if (meaning.definitions) {\r\n            const defWithExample = meaning.definitions.find(\r\n              (d: any) => d.example\r\n            );\r\n            if (defWithExample) newData.example = defWithExample.example;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (transRes && transRes.data && transRes.data[0]) {\r\n        const translatedText = transRes.data[0]\r\n          .map((item: any) => item[0])\r\n          .join(\"\");\r\n        newData.meaning = translatedText;\r\n      }\r\n      return newData;\r\n    } catch (error) {\r\n      console.error(\"Auto-fill error:\", error);\r\n      return null;\r\n    } finally {\r\n      setIsAutoFilling(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenCreateModal = async (initialWord = \"\") => {\r\n    setSelectedVocab(null);\r\n    setIsModalOpen(true);\r\n    setFormData({\r\n      word: initialWord,\r\n      meaning: \"\",\r\n      example: \"\",\r\n      topic: \"\",\r\n      partOfSpeech: \"\",\r\n      relatedWords: \"\",\r\n      pronunciation: \"\",\r\n    });\r\n    if (initialWord) {\r\n      const autoData = await fetchAutoFillData(initialWord);\r\n      if (autoData) {\r\n        setFormData((prev) => ({ ...prev, ...autoData }));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!token || !formData.word) {\r\n      alert(\"Word is required!\");\r\n      return;\r\n    }\r\n    try {\r\n      if (selectedVocab) {\r\n        await api.patch(\r\n          `/vocabulary/${selectedVocab.id}`,\r\n          formData,\r\n          { headers: { Authorization: `Bearer ${token}` } }\r\n        );\r\n      } else {\r\n        await api.post(\r\n          \"/vocabulary\",\r\n          { ...formData, isStarred: false },\r\n          { headers: { Authorization: `Bearer ${token}` } }\r\n        );\r\n      }\r\n      setIsModalOpen(false);\r\n      fetchVocabs();\r\n    } catch (error) {\r\n      console.error(\"Save failed\", error);\r\n      alert(\"Failed to save.\");\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Delete this word?\")) return;\r\n    try {\r\n      await api.delete(`/vocabulary/${id}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      fetchVocabs();\r\n      setIsModalOpen(false);\r\n    } catch (e) {\r\n      alert(\"Failed\");\r\n    }\r\n  };\r\n\r\n  const handleFileChange = async (\r\n    event: React.ChangeEvent<HTMLInputElement>\r\n  ) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file || !token) return;\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    try {\r\n      setIsUploading(true);\r\n      await api.post(\r\n        \"/vocabulary/import/csv\",\r\n        formData,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            \"Content-Type\": \"multipart/form-data\",\r\n          },\r\n        }\r\n      );\r\n      alert(\"Import success!\");\r\n      fetchVocabs(1);\r\n    } catch (error) {\r\n      alert(\"Import failed!\");\r\n    } finally {\r\n      setIsUploading(false);\r\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  return {\r\n    selectedVocab,\r\n    isModalOpen,\r\n    setIsModalOpen,\r\n    isAutoFilling,\r\n    formData,\r\n    setFormData,\r\n    fileInputRef,\r\n    isUploading,\r\n    handleRowClick,\r\n    handleOpenCreateModal,\r\n    handleSave,\r\n    handleDelete,\r\n    handleFileChange,\r\n    fetchAutoFillData,\r\n  };\r\n};\r\n\r\nexport default useVocabModals;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 420, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/hooks/vocabulary/usePronunciationAssessment.ts"],"sourcesContent":["\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport api from \"@/lib/api\"; // Import api for backend\r\nimport axios from \"axios\"; // Keep for Azure API\r\nimport { VocabItem } from \"./useVocabData\";\r\nimport { VocabFormData } from \"./useVocabModals\";\r\n\r\n// --- INTERFACES ---\r\nexport interface AssessmentResult {\r\n  AccuracyScore: number;\r\n  FluencyScore?: number;\r\n  CompletenessScore?: number;\r\n  PronScore?: number;\r\n  Words: Array<{\r\n    Word: string;\r\n    AccuracyScore: number;\r\n    ErrorType: string;\r\n    Phonemes: Array<{\r\n      Phoneme: string;\r\n      AccuracyScore: number;\r\n    }>;\r\n  }>;\r\n}\r\n\r\n// --- HELPERS ---\r\nasync function convertAudioToWav(audioBlob: Blob): Promise<Blob> {\r\n    const audioContext = new (window.AudioContext ||\r\n      (window as any).webkitAudioContext)({\r\n      sampleRate: 16000,\r\n    });\r\n    const arrayBuffer = await audioBlob.arrayBuffer();\r\n    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\r\n    const pcmData = audioBuffer.getChannelData(0);\r\n    const wavBuffer = encodeWAV(pcmData, 16000);\r\n    return new Blob([wavBuffer], { type: \"audio/wav\" });\r\n  }\r\n  \r\nfunction encodeWAV(samples: Float32Array, sampleRate: number) {\r\n    const buffer = new ArrayBuffer(44 + samples.length * 2);\r\n    const view = new DataView(buffer);\r\n    const writeString = (view: DataView, offset: number, string: string) => {\r\n      for (let i = 0; i < string.length; i++) {\r\n        view.setUint8(offset + i, string.charCodeAt(i));\r\n      }\r\n    };\r\n    writeString(view, 0, \"RIFF\");\r\n    view.setUint32(4, 36 + samples.length * 2, true);\r\n    writeString(view, 8, \"WAVE\");\r\n    writeString(view, 12, \"fmt \");\r\n    view.setUint32(16, 16, true);\r\n    view.setUint16(20, 1, true);\r\n    view.setUint16(22, 1, true);\r\n    view.setUint32(24, sampleRate, true);\r\n    view.setUint32(28, sampleRate * 2, true);\r\n    view.setUint16(32, 2, true);\r\n    view.setUint16(34, 16, true);\r\n    writeString(view, 36, \"data\");\r\n    view.setUint32(40, samples.length * 2, true);\r\n    let offset = 44;\r\n    for (let i = 0; i < samples.length; i++, offset += 2) {\r\n      let s = Math.max(-1, Math.min(1, samples[i]));\r\n      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\r\n    }\r\n    return view;\r\n}\r\n\r\n\r\nconst usePronunciationAssessment = (\r\n  token: string | null,\r\n  fetchVocabs: (page?: number) => void,\r\n  page: number\r\n) => {\r\n  const [isAssessmentModalOpen, setIsAssessmentModalOpen] = useState(false);\r\n  const [recordingVocabItem, setRecordingVocabItem] =\r\n    useState<VocabItem | null>(null);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [assessmentResult, setAssessmentResult] =\r\n    useState<AssessmentResult | null>(null);\r\n  const [assessmentError, setAssessmentError] = useState<string>(\"\");\r\n  const [isProcessingAudio, setIsProcessingAudio] = useState(false);\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n  const [userAudioUrl, setUserAudioUrl] = useState<string | null>(null);\r\n\r\n  const handleOpenAssessment = (\r\n    item: VocabItem | VocabFormData,\r\n    e?: React.MouseEvent\r\n  ) => {\r\n    if (e) e.stopPropagation();\r\n    const vocabItem =\r\n      \"id\" in item\r\n        ? item\r\n        : ({\r\n            ...item,\r\n            id: \"temp\",\r\n            occurrence: 0,\r\n            isStarred: false,\r\n            pronunciationScores: [],\r\n            createdAt: \"\",\r\n            updatedAt: \"\",\r\n          } as VocabItem);\r\n\r\n    setRecordingVocabItem(vocabItem);\r\n    setAssessmentResult(null);\r\n    setAssessmentError(\"\");\r\n    setUserAudioUrl(null);\r\n    setIsAssessmentModalOpen(true);\r\n  };\r\n\r\n  const startRecording = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      const mediaRecorder = new MediaRecorder(stream);\r\n      mediaRecorderRef.current = mediaRecorder;\r\n      audioChunksRef.current = [];\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) audioChunksRef.current.push(event.data);\r\n      };\r\n      mediaRecorder.onstop = async () => {\r\n        const audioBlob = new Blob(audioChunksRef.current, {\r\n          type: \"audio/webm\",\r\n        });\r\n        const audioUrl = URL.createObjectURL(audioBlob);\r\n        setUserAudioUrl(audioUrl);\r\n        await processAudio(audioBlob);\r\n        stream.getTracks().forEach((track) => track.stop());\r\n      };\r\n      mediaRecorder.start();\r\n      setIsRecording(true);\r\n      setAssessmentError(\"\");\r\n    } catch (err) {\r\n      setAssessmentError(\"Microphone access denied.\");\r\n    }\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorderRef.current && isRecording) {\r\n      mediaRecorderRef.current.stop();\r\n      setIsRecording(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    let timer: NodeJS.Timeout;\r\n    if (isAssessmentModalOpen) {\r\n      timer = setTimeout(() => {\r\n        if (!isRecording) {\r\n          startRecording();\r\n        }\r\n      }, 300);\r\n    } else {\r\n      stopRecording();\r\n    }\r\n    return () => clearTimeout(timer);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isAssessmentModalOpen]);\r\n\r\n  const processAudio = async (audioBlob: Blob) => {\r\n    if (!recordingVocabItem) return;\r\n    setIsProcessingAudio(true);\r\n    try {\r\n      const azureKey = localStorage.getItem(\"azureKey\");\r\n      const azureRegion = localStorage.getItem(\"azureRegion\");\r\n      if (!azureKey || !azureRegion) throw new Error(\"Missing Azure Keys.\");\r\n      const wavBlob = await convertAudioToWav(audioBlob);\r\n      const assessParams = {\r\n        ReferenceText: recordingVocabItem.word,\r\n        GradingSystem: \"HundredMark\",\r\n        Granularity: \"Phoneme\",\r\n        Dimension: \"Comprehensive\",\r\n        PhonemeAlphabet: \"IPA\",\r\n      };\r\n      const paramsHeader = btoa(JSON.stringify(assessParams));\r\n      const url = `https://${azureRegion}.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=en-US`;\r\n      const response = await axios.post(url, wavBlob, {\r\n        headers: {\r\n          \"Ocp-Apim-Subscription-Key\": azureKey,\r\n          \"Content-Type\": \"audio/wav; codecs=audio/pcm; samplerate=16000\",\r\n          Accept: \"application/json\",\r\n          \"Pronunciation-Assessment\": paramsHeader,\r\n        },\r\n      });\r\n      const data = response.data;\r\n      if (data.NBest && data.NBest[0]) {\r\n        const result = data.NBest[0];\r\n        const score =\r\n          result.PronunciationAssessment?.AccuracyScore || result.AccuracyScore;\r\n        setAssessmentResult({ AccuracyScore: score, Words: result.Words });\r\n\r\n        if (recordingVocabItem.id !== \"temp\") {\r\n          await api.patch(\r\n            `/vocabulary/${recordingVocabItem.id}/score`,\r\n            { score: Math.round(score) },\r\n            { headers: { Authorization: `Bearer ${token}` } }\r\n          );\r\n          fetchVocabs(page);\r\n        }\r\n      } else {\r\n        setAssessmentError(\"Could not recognize speech.\");\r\n      }\r\n    } catch (err: any) {\r\n      setAssessmentError(err.message);\r\n    } finally {\r\n      setIsProcessingAudio(false);\r\n    }\r\n  };\r\n\r\n // apps/frontend/hooks/vocabulary/usePronunciationAssessment.ts\r\n\r\n  const handleSpeak = (text: string, e?: React.MouseEvent) => {\r\n    if (e) e.stopPropagation();\r\n    if (!text) return;\r\n    window.speechSynthesis.cancel();\r\n\r\n    const utterance = new SpeechSynthesisUtterance(text);\r\n    utterance.lang = \"en-US\";\r\n    utterance.rate = 0.9; // Tá»‘c Ä‘á»™ Ä‘á»c (0.9 lÃ  vá»«a pháº£i)\r\n\r\n    // ðŸ‘‡ LOGIC Má»šI: Æ¯u tiÃªn tuyá»‡t Ä‘á»‘i cho Microsoft Aria Online\r\n    const getVoice = () => {\r\n      const voices = window.speechSynthesis.getVoices();\r\n      \r\n      // 1. TÃ¬m chÃ­nh xÃ¡c giá»ng Microsoft Aria Online (Æ¯u tiÃªn sá»‘ 1)\r\n      const ariaOnline = voices.find(v => v.name.includes(\"Microsoft Aria Online\"));\r\n      if (ariaOnline) return ariaOnline;\r\n\r\n      // 2. Náº¿u khÃ´ng cÃ³ Online, tÃ¬m giá»ng Aria báº¥t ká»³ (Æ¯u tiÃªn sá»‘ 2)\r\n      const ariaAny = voices.find(v => v.name.includes(\"Aria\"));\r\n      if (ariaAny) return ariaAny;\r\n\r\n      // 3. Fallback: TÃ¬m giá»ng US English tá»± nhiÃªn (Google US English, etc.)\r\n      return voices.find(v => v.lang === \"en-US\" && !v.name.includes(\"Zira\")); \r\n    };\r\n\r\n    const preferredVoice = getVoice();\r\n\r\n    if (preferredVoice) {\r\n      utterance.voice = preferredVoice;\r\n      // console.log(\"Using voice:\", preferredVoice.name); // Báº­t dÃ²ng nÃ y Ä‘á»ƒ debug xem nÃ³ Ä‘ang dÃ¹ng giá»ng nÃ o\r\n    }\r\n\r\n    window.speechSynthesis.speak(utterance);\r\n  };\r\n\r\n  return {\r\n    isAssessmentModalOpen,\r\n    setIsAssessmentModalOpen,\r\n    recordingVocabItem,\r\n    isRecording,\r\n    assessmentResult,\r\n    assessmentError,\r\n    isProcessingAudio,\r\n    userAudioUrl,\r\n    startRecording,\r\n    stopRecording,\r\n    handleOpenAssessment,\r\n    handleSpeak,\r\n  };\r\n};\r\n\r\nexport default usePronunciationAssessment;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 648, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/hooks/vocabulary/useQuickSearch.ts"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\r\nimport api from \"@/lib/api\"; // Import api\r\nimport { useSearchParams, usePathname } from \"next/navigation\";\r\nimport { VocabItem } from \"./useVocabData\";\r\n\r\nconst useQuickSearch = (\r\n  token: string | null,\r\n  handleOpenCreateModal: (word: string) => void\r\n) => {\r\n  const [showSearch, setShowSearch] = useState(false);\r\n  const [quickSearchText, setQuickSearchText] = useState(\"\");\r\n  const [quickSearchResults, setQuickSearchResults] = useState<VocabItem[]>([]);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const searchInputRef = useRef<HTMLInputElement>(null);\r\n  const quickSearchDebounce = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const searchParams = useSearchParams();\r\n  const pathname = usePathname();\r\n\r\n  useEffect(() => {\r\n    const isSearchPath = pathname?.endsWith(\"/search\");\r\n    const hasSearchParam = searchParams.get(\"openSearch\") === \"true\";\r\n\r\n    if (isSearchPath || hasSearchParam) {\r\n      setShowSearch(true);\r\n      setQuickSearchText(\"\");\r\n      setTimeout(() => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n        }\r\n      }, 100);\r\n    }\r\n  }, [pathname, searchParams]);\r\n\r\n  useEffect(() => {\r\n    let lastKeyPressTime = 0;\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n        const target = e.target as HTMLElement;\r\n        const isInputFocused = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable;\r\n\r\n        if (isInputFocused && !showSearch) return;\r\n\r\n\r\n      if (e.code === \"Space\") {\r\n        const currentTime = new Date().getTime();\r\n        if (currentTime - lastKeyPressTime < 300) {\r\n          e.preventDefault();\r\n          setShowSearch(true);\r\n          setQuickSearchText(\"\");\r\n          setQuickSearchResults([]);\r\n          setTimeout(() => searchInputRef.current?.focus(), 100);\r\n        }\r\n        lastKeyPressTime = currentTime;\r\n      }\r\n      if (e.code === \"Escape\") {\r\n        setShowSearch(false);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [showSearch]);\r\n\r\n  const handleQuickSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const text = e.target.value;\r\n    setQuickSearchText(text);\r\n    if (quickSearchDebounce.current) clearTimeout(quickSearchDebounce.current);\r\n    quickSearchDebounce.current = setTimeout(\r\n      () => performQuickSearch(text),\r\n      300\r\n    );\r\n  };\r\n\r\n  const performQuickSearch = async (text: string) => {\r\n    if (!token || !text.trim()) {\r\n      setQuickSearchResults([]);\r\n      return;\r\n    }\r\n    setIsSearching(true);\r\n    try {\r\n      const res = await api.get(\"/vocabulary\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        params: {\r\n          page: 1,\r\n          limit: 5,\r\n          search: text,\r\n          sortBy: \"word\",\r\n          sortOrder: \"asc\",\r\n        },\r\n      });\r\n      setQuickSearchResults(res.data.data);\r\n    } catch (error) {\r\n      console.error(\"Quick search error\", error);\r\n    } finally {\r\n      setIsSearching(false);\r\n    }\r\n  };\r\n\r\n  const hasExactMatch = quickSearchResults.some(\r\n    (item) => item.word.toLowerCase() === quickSearchText.trim().toLowerCase()\r\n  );\r\n\r\n  return {\r\n    showSearch,\r\n    setShowSearch,\r\n    quickSearchText,\r\n    setQuickSearchText,\r\n    quickSearchResults,\r\n    isSearching,\r\n    searchInputRef,\r\n    hasExactMatch,\r\n    handleQuickSearchChange,\r\n  };\r\n};\r\n\r\nexport default useQuickSearch;"],"names":[],"mappings":";;;;AAAA;AACA,yLAA6B,aAAa;AAC1C;;;;AAGA,MAAM,iBAAiB,CACrB,OACA;IAEA,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,iNAAQ,EAAc,EAAE;IAC5E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,iBAAiB,IAAA,+MAAM,EAAmB;IAChD,MAAM,sBAAsB,IAAA,+MAAM,EAAwB;IAE1D,MAAM,eAAe,IAAA,qJAAe;IACpC,MAAM,WAAW,IAAA,iJAAW;IAE5B,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe,UAAU,SAAS;QACxC,MAAM,iBAAiB,aAAa,GAAG,CAAC,kBAAkB;QAE1D,IAAI,gBAAgB,gBAAgB;YAClC,cAAc;YACd,mBAAmB;YACnB,WAAW;gBACT,IAAI,eAAe,OAAO,EAAE;oBAC1B,eAAe,OAAO,CAAC,KAAK;gBAC9B;YACF,GAAG;QACL;IACF,GAAG;QAAC;QAAU;KAAa;IAE3B,IAAA,kNAAS,EAAC;QACR,IAAI,mBAAmB;QACvB,MAAM,gBAAgB,CAAC;YACnB,MAAM,SAAS,EAAE,MAAM;YACvB,MAAM,iBAAiB,OAAO,OAAO,KAAK,WAAW,OAAO,OAAO,KAAK,cAAc,OAAO,iBAAiB;YAE9G,IAAI,kBAAkB,CAAC,YAAY;YAGrC,IAAI,EAAE,IAAI,KAAK,SAAS;gBACtB,MAAM,cAAc,IAAI,OAAO,OAAO;gBACtC,IAAI,cAAc,mBAAmB,KAAK;oBACxC,EAAE,cAAc;oBAChB,cAAc;oBACd,mBAAmB;oBACnB,sBAAsB,EAAE;oBACxB,WAAW,IAAM,eAAe,OAAO,EAAE,SAAS;gBACpD;gBACA,mBAAmB;YACrB;YACA,IAAI,EAAE,IAAI,KAAK,UAAU;gBACvB,cAAc;YAChB;QACF;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;KAAW;IAEf,MAAM,0BAA0B,CAAC;QAC/B,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK;QAC3B,mBAAmB;QACnB,IAAI,oBAAoB,OAAO,EAAE,aAAa,oBAAoB,OAAO;QACzE,oBAAoB,OAAO,GAAG,WAC5B,IAAM,mBAAmB,OACzB;IAEJ;IAEA,MAAM,qBAAqB,OAAO;QAChC,IAAI,CAAC,SAAS,CAAC,KAAK,IAAI,IAAI;YAC1B,sBAAsB,EAAE;YACxB;QACF;QACA,eAAe;QACf,IAAI;YACF,MAAM,MAAM,MAAM,qHAAG,CAAC,GAAG,CAAC,eAAe;gBACvC,SAAS;oBAAE,eAAe,CAAC,OAAO,EAAE,OAAO;gBAAC;gBAC5C,QAAQ;oBACN,MAAM;oBACN,OAAO;oBACP,QAAQ;oBACR,QAAQ;oBACR,WAAW;gBACb;YACF;YACA,sBAAsB,IAAI,IAAI,CAAC,IAAI;QACrC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;QACtC,SAAU;YACR,eAAe;QACjB;IACF;IAEA,MAAM,gBAAgB,mBAAmB,IAAI,CAC3C,CAAC,OAAS,KAAK,IAAI,CAAC,WAAW,OAAO,gBAAgB,IAAI,GAAG,WAAW;IAG1E,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;uCAEe"}},
    {"offset": {"line": 759, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/components/Icons.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\nexport const StarIcon = ({ filled, className }: { filled: boolean; className?: string }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill={filled ? \"currentColor\" : \"none\"} stroke=\"currentColor\" strokeWidth={filled ? \"0\" : \"2\"} strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className} width=\"24\" height=\"24\">\r\n    <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" />\r\n  </svg>\r\n);\r\n\r\nexport const SpeakerIcon = ({ className }: { className?: string }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n    <polygon points=\"11 5 6 9 2 9 2 15 6 15 11 19 11 5\"></polygon>\r\n    <path d=\"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07\"></path>\r\n  </svg>\r\n);\r\n\r\nexport const MicrophoneIcon = ({ className }: { className?: string }) => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\r\n    <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"></path>\r\n    <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"></path>\r\n    <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"></line>\r\n    <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"></line>\r\n  </svg>\r\n);"],"names":[],"mappings":";;;;;;;;;;AAEO,MAAM,WAAW,CAAC,EAAE,MAAM,EAAE,SAAS,EAA2C,iBACrF,8OAAC;QAAI,OAAM;QAA6B,SAAQ;QAAY,MAAM,SAAS,iBAAiB;QAAQ,QAAO;QAAe,aAAa,SAAS,MAAM;QAAK,eAAc;QAAQ,gBAAe;QAAQ,WAAW;QAAW,OAAM;QAAK,QAAO;kBAC9O,cAAA,8OAAC;YAAK,GAAE;;;;;;;;;;;AAIL,MAAM,cAAc,CAAC,EAAE,SAAS,EAA0B,iBAC/D,8OAAC;QAAI,OAAM;QAA6B,OAAM;QAAK,QAAO;QAAK,SAAQ;QAAY,MAAK;QAAO,QAAO;QAAe,aAAY;QAAI,eAAc;QAAQ,gBAAe;QAAQ,WAAW;;0BAC3L,8OAAC;gBAAQ,QAAO;;;;;;0BAChB,8OAAC;gBAAK,GAAE;;;;;;;;;;;;AAIL,MAAM,iBAAiB,CAAC,EAAE,SAAS,EAA0B,iBAClE,8OAAC;QAAI,OAAM;QAA6B,OAAM;QAAK,QAAO;QAAK,SAAQ;QAAY,MAAK;QAAO,QAAO;QAAe,aAAY;QAAI,eAAc;QAAQ,gBAAe;QAAQ,WAAW;;0BAC3L,8OAAC;gBAAK,GAAE;;;;;;0BACR,8OAAC;gBAAK,GAAE;;;;;;0BACR,8OAAC;gBAAK,IAAG;gBAAK,IAAG;gBAAK,IAAG;gBAAK,IAAG;;;;;;0BACjC,8OAAC;gBAAK,IAAG;gBAAI,IAAG;gBAAK,IAAG;gBAAK,IAAG"}},
    {"offset": {"line": 880, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/components/vocabulary/VocabTable.tsx"],"sourcesContent":["\nimport React from \"react\";\nimport {\n  VocabItem,\n  FilterState,\n  SortState,\n} from \"@/hooks/vocabulary/useVocabData\";\nimport { StarIcon, MicrophoneIcon, SpeakerIcon } from \"@/components/Icons\";\n\ninterface Props {\n  vocabs: VocabItem[];\n  loading: boolean;\n  page: number;\n  totalPages: number;\n  setPage: (page: number) => void;\n  fetchVocabs: (\n    pageNum?: number,\n    filters?: FilterState,\n    sort?: SortState\n  ) => void;\n  filters: FilterState;\n  handleFilterChange: (key: keyof FilterState, value: string) => void;\n  handleSort: (key: string) => void;\n  sortConfig: SortState;\n  columnOrder: string[];\n  handleDragStart: (e: React.DragEvent, col: string) => void;\n  handleDragOver: (e: React.DragEvent, col: string) => void;\n  handleDragEnd: () => void;\n  draggedCol: string | null;\n  handleRowClick: (item: VocabItem) => void;\n  handleToggleStar: (id: string, status: boolean, e: React.MouseEvent) => void;\n  handleSpeak: (text: string, e: React.MouseEvent) => void;\n  handleOpenAssessment: (item: VocabItem, e: React.MouseEvent) => void;\n  triggerInteraction: (vocab: VocabItem) => void;\n}\n\nexport default function VocabTable({\n  vocabs,\n  loading,\n  page,\n  totalPages,\n  setPage,\n  fetchVocabs,\n  filters,\n  handleFilterChange,\n  handleSort,\n  sortConfig,\n  columnOrder,\n  handleDragStart,\n  handleDragOver,\n  handleDragEnd,\n  draggedCol,\n  handleRowClick,\n  handleToggleStar,\n  handleSpeak,\n  handleOpenAssessment,\n  triggerInteraction,\n}: Props) {\n  const handlePageChange = (newPage: number) => {\n    setPage(newPage);\n    fetchVocabs(newPage, filters, sortConfig);\n  };\n\n  const getSortIcon = (colKey: string) =>\n    sortConfig.key !== colKey ? (\n      <span className=\"text-gray-300 ml-1 opacity-50\">â†•</span>\n    ) : sortConfig.direction === \"asc\" ? (\n      <span className=\"ml-1 text-indigo-600\">â–²</span>\n    ) : (\n      <span className=\"ml-1 text-indigo-600\">â–¼</span>\n    );\n\n  const columnConfig: Record<\n    string,\n    {\n      label: React.ReactNode;\n      width: string;\n      renderCell: (v: VocabItem) => React.ReactNode;\n      renderFilter?: () => React.ReactNode;\n      sortKey?: string;\n    }\n  > = {\n    star: {\n      label: \"â˜…\",\n      width: \"w-12\",\n      sortKey: \"isStarred\",\n      renderCell: (v) => (\n        <button\n          onClick={(e) => handleToggleStar(v.id, v.isStarred, e)}\n          className=\"hover:bg-gray-100 rounded-full p-1\"\n        >\n          <StarIcon\n            filled={v.isStarred}\n            className={\n              v.isStarred ? \"text-yellow-400 w-5 h-5\" : \"text-gray-300 w-5 h-5\"\n            }\n          />\n        </button>\n      ),\n    },\n    updatedAt: {\n      label: \"Last Active\",\n      width: \"w-32\",\n      sortKey: \"updatedAt\",\n      renderCell: (v) => (\n        <div className=\"font-mono text-xs text-gray-500\">\n          {new Date(v.updatedAt).toLocaleDateString()} <br />\n          <span className=\"text-gray-400\">\n            {new Date(v.updatedAt).toLocaleTimeString()}\n          </span>\n        </div>\n      ),\n    },\n    topic: {\n      label: \"Topic\",\n      width: \"w-32\",\n      sortKey: \"topic\",\n      renderCell: (v) =>\n        v.topic && (\n          <span className=\"bg-gray-100 px-2 py-0.5 rounded text-xs\">\n            {v.topic}\n          </span>\n        ),\n      renderFilter: () => (\n        <input\n          className=\"w-full border rounded px-2 py-1 text-xs outline-none focus:border-indigo-500\"\n          placeholder=\"Filter...\"\n          value={filters.topic}\n          onChange={(e) => handleFilterChange(\"topic\", e.target.value)}\n        />\n      ),\n    },\n    word: {\n      label: \"Word\",\n      width: \"w-48\",\n      sortKey: \"word\",\n      renderCell: (v) => (\n        <div className=\"flex items-center justify-between gap-2 font-bold text-indigo-700\">\n          <span>{v.word}</span>\n          <div className=\"flex items-center gap-1\">\n            <button\n              onClick={(e) => {\n                handleOpenAssessment(v, e);\n                triggerInteraction(v);\n              }}\n              className=\"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-50\"\n              title=\"Practice Pronunciation\"\n            >\n              <MicrophoneIcon className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={(e) => {\n                handleSpeak(v.word, e);\n                triggerInteraction(v);\n              }}\n              className=\"text-gray-400 hover:text-indigo-600 p-1 rounded-full hover:bg-indigo-50\"\n            >\n              <SpeakerIcon className=\"w-4 h-4\" />\n            </button>\n          </div>\n        </div>\n      ),\n      renderFilter: () => (\n        <input\n          className=\"w-full border rounded px-2 py-1 text-xs outline-none focus:border-indigo-500\"\n          placeholder=\"Filter...\"\n          value={filters.word}\n          onChange={(e) => handleFilterChange(\"word\", e.target.value)}\n        />\n      ),\n    },\n    pronunciation: {\n      label: \"Pronun.\",\n      width: \"w-32\",\n      renderCell: (v) => (\n        <span className=\"font-mono text-gray-500 text-xs\">\n          {v.pronunciation}\n        </span>\n      ),\n    },\n    meaning: {\n      label: \"Meaning\",\n      width: \"w-48\",\n      renderCell: (v) => (\n        <span\n          className=\"text-gray-800 text-sm line-clamp-2\"\n          title={v.meaning || \"\"}\n        >\n          {v.meaning}\n        </span>\n      ),\n      renderFilter: () => (\n        <input\n          className=\"w-full border rounded px-2 py-1 text-xs outline-none focus:border-indigo-500\"\n          placeholder=\"Meaning...\"\n          value={filters.meaning}\n          onChange={(e) => handleFilterChange(\"meaning\", e.target.value)}\n        />\n      ),\n    },\n    example: {\n      label: \"Example\",\n      width: \"w-64\",\n      renderCell: (v) => (\n        <span\n          className=\"italic text-gray-500 text-xs line-clamp-2\"\n          title={v.example || \"\"}\n        >\n          {v.example}\n        </span>\n      ),\n    },\n    relatedWords: {\n      label: \"Related\",\n      width: \"w-40\",\n      renderCell: (v) => (\n        <span className=\"text-gray-500 text-xs\">{v.relatedWords}</span>\n      ),\n    },\n    occurrence: {\n      label: \"Count\",\n      width: \"w-20\",\n      sortKey: \"occurrence\",\n      renderCell: (v) => (\n        <div className=\"text-center font-semibold text-gray-500\">\n          {v.occurrence}\n        </div>\n      ),\n    },\n    score: {\n      label: \"Score\",\n      width: \"w-20\",\n      renderCell: (v) => {\n        const scores = v.pronunciationScores || [];\n        if (scores.length === 0)\n          return <span className=\"text-gray-300 text-xs\">-</span>;\n        const recentScores = scores.slice(-3);\n        const avg = Math.round(\n          recentScores.reduce((a, b) => a + b, 0) / recentScores.length\n        );\n        let colorClass = \"bg-red-100 text-red-700\";\n        if (avg >= 80) colorClass = \"bg-green-100 text-green-700\";\n        else if (avg >= 60) colorClass = \"bg-yellow-100 text-yellow-700\";\n        return (\n          <div className=\"flex flex-col items-center\">\n            <span\n              className={`text-xs font-bold px-2 py-0.5 rounded ${colorClass}`}\n            >\n              {avg}\n            </span>\n          </div>\n        );\n      },\n    },\n    actions: {\n      label: \"Action\",\n      width: \"w-20\",\n      renderCell: (v) => (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            handleRowClick(v);\n          }}\n          className=\"text-indigo-600 text-xs border border-indigo-200 px-2 py-1 rounded hover:bg-indigo-50\"\n        >\n          Edit\n        </button>\n      ),\n    },\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col\">\n      <div className=\"overflow-x-auto pb-4\">\n        <table className=\"min-w-full divide-y divide-gray-200 table-fixed\">\n          <thead className=\"bg-gray-50 select-none\">\n            <tr>\n              {columnOrder.map((colId) => {\n                const config = columnConfig[colId];\n                if (!config) return null;\n                const isDragging = draggedCol === colId;\n                return (\n                  <th\n                    key={colId}\n                    draggable\n                    onDragStart={(e) => handleDragStart(e, colId)}\n                    onDragOver={(e) => handleDragOver(e, colId)}\n                    onDragEnd={handleDragEnd}\n                    onClick={() => config.sortKey && handleSort(config.sortKey)}\n                    className={`${\n                      config.width\n                    } px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase border-r border-gray-200 cursor-move hover:bg-gray-100 transition-all duration-200 ${\n                      isDragging\n                        ? \"opacity-50 bg-indigo-50 border-2 border-indigo-300 scale-95 shadow-inner\"\n                        : \"\"\n                    } ${\n                      colId === \"actions\"\n                        ? \"sticky right-0 bg-gray-50 shadow-l z-10\"\n                        : \"\"\n                    }`}\n                  >\n                    <div className=\"flex items-center justify-between pointer-events-none\">\n                      <span>{config.label}</span>\n                      {config.sortKey && getSortIcon(config.sortKey)}\n                    </div>\n                  </th>\n                );\n              })}\n            </tr>\n            <tr className=\"bg-white border-b border-gray-200\">\n              {columnOrder.map((colId) => {\n                const config = columnConfig[colId];\n                if (!config) return null;\n                return (\n                  <td\n                    key={colId}\n                    className={`p-2 border-r border-gray-100 ${\n                      colId === \"actions\"\n                        ? \"sticky right-0 bg-white z-10\"\n                        : \"\"\n                    }`}\n                  >\n                    {config.renderFilter ? config.renderFilter() : null}\n                  </td>\n                );\n              })}\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {loading ? (\n              <tr>\n                <td\n                  colSpan={columnOrder.length}\n                  className=\"text-center py-10 text-gray-500\"\n                >\n                  Loading data...\n                </td>\n              </tr>\n            ) : vocabs.length === 0 ? (\n              <tr>\n                <td\n                  colSpan={columnOrder.length}\n                  className=\"text-center py-10 text-gray-500\"\n                >\n                  No vocabulary found.\n                </td>\n              </tr>\n            ) : (\n              vocabs.map((vocab) => (\n                <tr\n                  key={vocab.id}\n                  className=\"hover:bg-indigo-50/50 group transition-colors cursor-pointer\"\n                  onClick={() => handleRowClick(vocab)}\n                >\n                  {columnOrder.map((colId) => {\n                    const config = columnConfig[colId];\n                    if (!config) return null;\n                    return (\n                      <td\n                        key={colId}\n                        className={`px-4 py-3 text-sm border-r border-gray-100 align-top whitespace-normal break-words ${\n                          colId === \"actions\"\n                            ? \"sticky right-0 bg-white group-hover:bg-indigo-50/50 shadow-l z-10\"\n                            : \"\"\n                        }`}\n                        onClick={\n                          colId === \"actions\" || colId === \"star\"\n                            ? (e) => e.stopPropagation()\n                            : undefined\n                        }\n                      >\n                        {config.renderCell(vocab)}\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n      <div className=\"p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center sticky bottom-0 z-20\">\n        <button\n          disabled={page <= 1}\n          onClick={() => handlePageChange(page - 1)}\n          className=\"px-4 py-2 bg-white border rounded shadow-sm hover:bg-gray-100 disabled:opacity-50 text-sm font-medium\"\n        >\n          â† Previous\n        </button>\n        <span className=\"text-sm font-medium text-gray-600\">\n          Page <span className=\"text-indigo-600 font-bold\">{page}</span> of{\" \"}\n          {totalPages}\n        </span>\n        <button\n          disabled={page >= totalPages}\n          onClick={() => handlePageChange(page + 1)}\n          className=\"px-4 py-2 bg-white border rounded shadow-sm hover:bg-gray-100 disabled:opacity-50 text-sm font-medium\"\n        >\n          Next â†’\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1395, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/components/vocabulary/VocabFormModal.tsx"],"sourcesContent":["\nimport React from \"react\";\nimport { MicrophoneIcon, SpeakerIcon } from \"@/components/Icons\";\nimport { VocabFormData } from \"@/hooks/vocabulary/useVocabModals\";\nimport { VocabItem } from \"@/hooks/vocabulary/useVocabData\";\n\ninterface Props {\n  isOpen: boolean;\n  onClose: () => void;\n  initialData: VocabFormData;\n  setInitialData: (data: VocabFormData) => void;\n  isEditMode: boolean;\n  onSave: () => void;\n  onDelete: (() => void) | undefined;\n  isAutoFilling: boolean;\n  fetchAutoFillData: (word: string) => Promise<Partial<VocabFormData> | null>;\n  handleOpenAssessment: (item: VocabFormData, e?: React.MouseEvent) => void;\n  handleSpeak: (text: string, e?: React.MouseEvent) => void;\n  selectedVocab: VocabItem | null;\n}\n\nexport default function VocabFormModal({\n  isOpen,\n  onClose,\n  initialData: formData,\n  setInitialData: setFormData,\n  isEditMode,\n  onSave,\n  onDelete,\n  isAutoFilling,\n  fetchAutoFillData,\n  handleOpenAssessment,\n  handleSpeak,\n  selectedVocab,\n}: Props) {\n  if (!isOpen) return null;\n\n  const handleAutoFill = async () => {\n    if (!isEditMode) {\n      const autoData = await fetchAutoFillData(formData.word);\n      if (autoData) {\n        setFormData({ ...formData, ...autoData });\n      }\n    }\n  };\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/60 z-[150] flex items-center justify-center p-4 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"bg-indigo-600 p-6 text-white flex justify-between items-start shrink-0\">\n          <div className=\"w-full\">\n            <div className=\"text-xs uppercase tracking-wider opacity-80 mb-2\">\n              {isEditMode ? \"Editing Vocabulary\" : \"Create New Vocabulary\"}\n            </div>\n            <div className=\"flex items-center gap-3 w-full\">\n              <input\n                value={formData.word || \"\"}\n                onChange={(e) =>\n                  setFormData({ ...formData, word: e.target.value })\n                }\n                onBlur={handleAutoFill}\n                className=\"bg-transparent text-4xl font-bold text-white placeholder-white/50 outline-none w-full border-b border-white/20 pb-1 focus:border-white transition-colors\"\n                placeholder=\"Word...\"\n                autoFocus={!isEditMode}\n              />\n\n              {isAutoFilling && (\n                <div className=\"text-xs text-indigo-200 animate-pulse ml-2 whitespace-nowrap\">\n                  âœ¨ Auto-filling...\n                </div>\n              )}\n\n              {formData.word && (\n                <>\n                  <button\n                    onClick={(e) => handleOpenAssessment(formData, e)}\n                    className=\"p-2 bg-white/20 rounded-full hover:bg-green-500 text-white transition-colors\"\n                  >\n                    <MicrophoneIcon className=\"w-6 h-6\" />\n                  </button>\n                  <button\n                    onClick={(e) => handleSpeak(formData.word, e)}\n                    className=\"p-2 bg-white/20 rounded-full hover:bg-white/30 text-white\"\n                  >\n                    <SpeakerIcon className=\"w-6 h-6\" />\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-white/70 hover:text-white text-2xl font-bold ml-4\"\n          >\n            âœ•\n          </button>\n        </div>\n        <div className=\"p-6 space-y-5 overflow-y-auto relative\">\n          {isAutoFilling && (\n            <div className=\"absolute inset-0 bg-white/50 z-10 flex items-center justify-center\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600\"></div>\n            </div>\n          )}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n                Pronunciation\n              </label>\n              <input\n                value={formData.pronunciation || \"\"}\n                onChange={(e) =>\n                  setFormData({\n                    ...formData,\n                    pronunciation: e.target.value,\n                  })\n                }\n                className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-sm\"\n                placeholder=\"/.../\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n                Part Of Speech\n              </label>\n              <select\n                value={formData.partOfSpeech || \"\"}\n                onChange={(e) =>\n                  setFormData({ ...formData, partOfSpeech: e.target.value })\n                }\n                className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none bg-white\"\n              >\n                <option value=\"\">-- Select --</option>\n                <option value=\"noun\">Noun</option>\n                <option value=\"verb\">Verb</option>\n                <option value=\"adjective\">Adjective</option>\n                <option value=\"adverb\">Adverb</option>\n                <option value=\"phrase\">Phrase</option>\n              </select>\n            </div>\n          </div>\n          <div>\n            <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n              Meaning\n            </label>\n            <textarea\n              value={formData.meaning || \"\"}\n              onChange={(e) =>\n                setFormData({ ...formData, meaning: e.target.value })\n              }\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none min-h-[80px] text-lg font-medium text-gray-800\"\n              placeholder=\"NghÄ©a cá»§a tá»«...\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n              Example\n            </label>\n            <textarea\n              value={formData.example || \"\"}\n              onChange={(e) =>\n                setFormData({ ...formData, example: e.target.value })\n              }\n              className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none bg-gray-50 italic text-gray-600\"\n              placeholder=\"VÃ­ dá»¥...\"\n            />\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n                Topic\n              </label>\n              <input\n                value={formData.topic || \"\"}\n                onChange={(e) =>\n                  setFormData({ ...formData, topic: e.target.value })\n                }\n                className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none\"\n                placeholder=\"IT, Travel...\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-bold text-gray-400 uppercase mb-1\">\n                Related Words\n              </label>\n              <input\n                value={formData.relatedWords || \"\"}\n                onChange={(e) =>\n                  setFormData({ ...formData, relatedWords: e.target.value })\n                }\n                className=\"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none\"\n                placeholder=\"Synonyms...\"\n              />\n            </div>\n          </div>\n        </div>\n        <div className=\"bg-gray-50 p-4 border-t border-gray-200 flex justify-between items-center shrink-0\">\n          {selectedVocab ? (\n            <div className=\"text-xs text-gray-400\">\n              Updated: {new Date(selectedVocab.updatedAt).toLocaleString()}\n            </div>\n          ) : (\n            <div></div>\n          )}\n          <div className=\"flex gap-3\">\n            {isEditMode && onDelete && (\n              <button\n                onClick={onDelete}\n                className=\"text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg text-sm font-medium transition-colors border border-transparent hover:border-red-200\"\n              >\n                Delete\n              </button>\n            )}\n            <button\n              onClick={onClose}\n              className=\"text-gray-600 hover:bg-gray-200 px-5 py-2 rounded-lg text-sm font-medium transition-colors\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={onSave}\n              className=\"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm font-bold shadow-md transform active:scale-95 transition-all\"\n            >\n              {isEditMode ? \"Save Changes\" : \"Create Word\"}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1864, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/components/vocabulary/AssessmentModal.tsx"],"sourcesContent":["import React from \"react\";\nimport { MicrophoneIcon, SpeakerIcon } from \"@/components/Icons\";\nimport { AssessmentResult } from \"@/hooks/vocabulary/usePronunciationAssessment\";\nimport { VocabItem } from \"@/hooks/vocabulary/useVocabData\";\n\ninterface Props {\n  isOpen: boolean;\n  onClose: () => void;\n  vocabItem: VocabItem | null;\n  isRecording: boolean;\n  assessmentResult: AssessmentResult | null;\n  assessmentError: string;\n  isProcessingAudio: boolean;\n  userAudioUrl: string | null;\n  startRecording: () => void;\n  stopRecording: () => void;\n  handleSpeak: (text: string, e?: React.MouseEvent) => void;\n}\n\nexport default function AssessmentModal({\n  isOpen,\n  onClose,\n  vocabItem,\n  isRecording,\n  assessmentResult,\n  assessmentError,\n  isProcessingAudio,\n  userAudioUrl,\n  startRecording,\n  stopRecording,\n  handleSpeak,\n}: Props) {\n  if (!isOpen || !vocabItem) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/80 z-[2147483649] flex items-center justify-center p-4 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col items-center p-8 relative animate-in fade-in zoom-in duration-200\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <button\n          onClick={onClose}\n          className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600\"\n        >\n          âœ•\n        </button>\n        <h3 className=\"text-3xl font-bold text-gray-800 mb-1\">\n          {vocabItem.word}\n        </h3>\n        <div className=\"flex flex-col items-center gap-1 mb-6\">\n          {vocabItem.pronunciation && (\n            <span className=\"font-mono text-gray-500 text-lg\">\n              /{vocabItem.pronunciation}/\n            </span>\n          )}\n          {vocabItem.meaning && (\n            <span className=\"text-gray-600 text-center font-medium px-4 line-clamp-2\">\n              {vocabItem.meaning}\n            </span>\n          )}\n        </div>\n        {assessmentResult ? (\n          <div\n            className=\"relative w-32 h-32 mb-6 flex items-center justify-center rounded-full border-8 transition-all duration-500 ease-out\"\n            style={{\n              borderColor:\n                assessmentResult.AccuracyScore >= 80\n                  ? \"#4caf50\"\n                  : assessmentResult.AccuracyScore >= 60\n                  ? \"#ffeb3b\"\n                  : \"#ff5252\",\n            }}\n          >\n            <span\n              className=\"text-4xl font-bold\"\n              style={{\n                color:\n                  assessmentResult.AccuracyScore >= 80\n                    ? \"#4caf50\"\n                    : assessmentResult.AccuracyScore >= 60\n                    ? \"#fbc02d\"\n                    : \"#ff5252\",\n              }}\n            >\n              {Math.round(assessmentResult.AccuracyScore)}\n            </span>\n          </div>\n        ) : (\n          <div className=\"w-32 h-32 mb-6 rounded-full border-4 border-gray-100 flex items-center justify-center bg-gray-50\">\n            <span className=\"text-4xl text-gray-300\">?</span>\n          </div>\n        )}\n        <div className=\"mb-6 flex gap-6 items-center\">\n          <button\n            onClick={(e) => handleSpeak(vocabItem.word, e)}\n            className=\"w-12 h-12 rounded-full bg-gray-100 hover:bg-gray-200 text-indigo-600 flex items-center justify-center transition-transform hover:scale-105 shadow-sm\"\n            title=\"Nghe giá»ng chuáº©n\"\n          >\n            <SpeakerIcon className=\"w-6 h-6\" />\n          </button>\n          <button\n            onClick={isRecording ? stopRecording : startRecording}\n            className={`w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-all transform hover:scale-105 ${\n              isRecording\n                ? \"bg-red-500 animate-pulse ring-4 ring-red-200\"\n                : \"bg-indigo-600 hover:bg-indigo-700 ring-4 ring-indigo-100\"\n            }`}\n          >\n            {isRecording ? (\n              <div className=\"w-6 h-6 bg-white rounded-sm\" />\n            ) : (\n              <MicrophoneIcon className=\"w-8 h-8 text-white\" />\n            )}\n          </button>\n          <button\n            disabled={!userAudioUrl}\n            onClick={() => {\n              const audio = new Audio(userAudioUrl!);\n              audio.play();\n            }}\n            className={`w-12 h-12 rounded-full flex items-center justify-center transition-transform hover:scale-105 shadow-sm ${\n              userAudioUrl\n                ? \"bg-green-100 hover:bg-green-200 text-green-700 cursor-pointer\"\n                : \"bg-gray-100 text-gray-300 cursor-not-allowed\"\n            }`}\n            title=\"Nghe láº¡i giá»ng báº¡n\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              className=\"w-5 h-5\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z\"\n              />\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n          </button>\n        </div>\n        {isProcessingAudio && (\n          <p className=\"text-indigo-500 font-medium animate-pulse\">\n            Analyzing...\n          </p>\n        )}\n        {assessmentError && (\n          <p className=\"text-red-500 text-sm text-center bg-red-50 p-2 rounded\">\n            {assessmentError}\n          </p>\n        )}\n        {assessmentResult && (\n          <div className=\"w-full bg-gray-50 rounded-xl p-4 mt-2 border border-gray-100\">\n            <div className=\"flex flex-wrap justify-center gap-x-4 gap-y-2\">\n              {assessmentResult.Words.map((word, idx) => (\n                <div key={idx} className=\"flex flex-col items-center\">\n                  <span\n                    className={`text-lg font-bold ${\n                      word.AccuracyScore >= 80\n                        ? \"text-green-700\"\n                        : word.AccuracyScore >= 60\n                        ? \"text-yellow-600\"\n                        : \"text-red-600\"\n                    }`}\n                  >\n                    {word.Word}\n                  </span>\n                  <div className=\"flex gap-0.5 mt-1\">\n                    {word.Phonemes?.map((p, pIdx) => (\n                      <span\n                        key={pIdx}\n                        className={`text-xs px-1 rounded min-w-[20px] text-center ${\n                          p.AccuracyScore >= 80\n                            ? \"bg-green-100 text-green-800\"\n                            : p.AccuracyScore >= 60\n                            ? \"bg-yellow-100 text-yellow-800\"\n                            : \"bg-red-100 text-red-800\"\n                        }`}\n                        title={`/${p.Phoneme}/: ${p.AccuracyScore}`}\n                      >\n                        {p.Phoneme}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2133, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/components/vocabulary/QuickSearchModal.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { VocabItem } from \"@/hooks/vocabulary/useVocabData\";\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  searchText: string;\r\n  onSearchChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n  results: VocabItem[];\r\n  isSearching: boolean;\r\n  \r\n  // CÃ¡c Actions\r\n  onSelect: (item: VocabItem) => void;\r\n  onCreate: () => void;\r\n  hasExactMatch: boolean;\r\n  searchInputRef: React.RefObject<HTMLInputElement>;\r\n  handleSpeak: (text: string, e?: React.MouseEvent) => void;\r\n  handleOpenAssessment: (item: VocabItem, e?: React.MouseEvent) => void;\r\n  triggerInteraction: (item: VocabItem) => void;\r\n}\r\n\r\nexport default function QuickSearchModal({\r\n  isOpen,\r\n  onClose,\r\n  searchText,\r\n  onSearchChange,\r\n  results,\r\n  isSearching,\r\n  onSelect,\r\n  onCreate,\r\n  hasExactMatch,\r\n  searchInputRef,\r\n  handleSpeak,\r\n  handleOpenAssessment,\r\n  triggerInteraction\r\n}: Props) {\r\n  const [translation, setTranslation] = useState<string>(\"\");\r\n  const [pronunciation, setPronunciation] = useState<string>(\"\");\r\n  const [partOfSpeech, setPartOfSpeech] = useState<string>(\"\");\r\n  const [isTranslating, setIsTranslating] = useState(false);\r\n\r\n  // Auto translate when search text changes and no exact match\r\n  useEffect(() => {\r\n    if (isOpen && searchInputRef.current) {\r\n      setTimeout(() => searchInputRef.current?.focus(), 100);\r\n    }\r\n  }, [isOpen, searchInputRef]);\r\n\r\n  useEffect(() => {\r\n    const fetchTranslation = async () => {\r\n      // Chá»‰ reset khi cÃ³ exact match, khÃ´ng phá»¥ thuá»™c vÃ o results.length\r\n      if (!searchText || hasExactMatch) {\r\n        setTranslation(\"\");\r\n        setPronunciation(\"\");\r\n        setPartOfSpeech(\"\");\r\n        return;\r\n      }\r\n\r\n      setIsTranslating(true);\r\n      try {\r\n        // Fetch cáº£ dictionary vÃ  translation nhÆ° code autofill hiá»‡n táº¡i\r\n        const dictPromise = axios\r\n          .get(`https://api.dictionaryapi.dev/api/v2/entries/en/${searchText}`)\r\n          .catch(() => null);\r\n\r\n        const translatePromise = axios\r\n          .get(\r\n            `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(\r\n              searchText\r\n            )}`\r\n          )\r\n          .catch(() => null);\r\n\r\n        const [dictRes, transRes] = await Promise.all([\r\n          dictPromise,\r\n          translatePromise,\r\n        ]);\r\n\r\n        // Xá»­ lÃ½ dictionary data\r\n        if (dictRes && dictRes.data && dictRes.data[0]) {\r\n          const entry = dictRes.data[0];\r\n          \r\n          // Pronunciation\r\n          if (entry.phonetic) {\r\n            setPronunciation(entry.phonetic);\r\n          } else if (entry.phonetics && entry.phonetics.length > 0) {\r\n            const p = entry.phonetics.find((x: any) => x.text && x.audio);\r\n            setPronunciation(p ? p.text : entry.phonetics[0].text || \"\");\r\n          }\r\n          \r\n          // Part of Speech\r\n          if (entry.meanings && entry.meanings.length > 0) {\r\n            setPartOfSpeech(entry.meanings[0].partOfSpeech || \"\");\r\n          }\r\n        }\r\n\r\n        // Xá»­ lÃ½ translation\r\n        if (transRes && transRes.data && transRes.data[0]) {\r\n          const translatedText = transRes.data[0]\r\n            .map((item: any) => item[0])\r\n            .join(\"\");\r\n          setTranslation(translatedText);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Translation error:\", error);\r\n        setTranslation(\"\");\r\n        setPronunciation(\"\");\r\n        setPartOfSpeech(\"\");\r\n      } finally {\r\n        setIsTranslating(false);\r\n      }\r\n    };\r\n\r\n    const debounceTimer = setTimeout(() => {\r\n      fetchTranslation();\r\n    }, 500);\r\n\r\n    return () => clearTimeout(debounceTimer);\r\n  }, [searchText, hasExactMatch]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div \r\n      className=\"fixed inset-0 z-[100] flex items-start justify-center pt-20\"\r\n      onClick={onClose}\r\n      style={{ backgroundColor: 'transparent' }}\r\n    >\r\n      <div\r\n        className=\"bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col mx-4 border border-gray-100\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"p-4 border-b border-gray-100 flex items-center gap-3\">\r\n          <span className=\"text-xl\">ðŸ”</span>\r\n          <input\r\n            ref={searchInputRef}\r\n            type=\"text\"\r\n            value={searchText}\r\n            onChange={onSearchChange}\r\n            onKeyDown={(e) => {\r\n              if (e.key === \"Enter\" && results.length === 0 && !hasExactMatch) {\r\n                onCreate();\r\n              }\r\n            }}\r\n            placeholder=\"Type to search or create...\"\r\n            className=\"flex-1 text-xl font-light outline-none bg-transparent h-10\"\r\n          />\r\n          <div className=\"text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded\">\r\n            ESC to close\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-gray-50 max-h-[60vh] overflow-y-auto\">\r\n          {isSearching ? (\r\n            <div className=\"p-8 text-center text-gray-400\">Searching...</div>\r\n          ) : (\r\n            <>\r\n              {/* Google Translate Preview Section - Show when no exact match */}\r\n              {searchText && !hasExactMatch && (\r\n                <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100\">\r\n                  <div className=\"p-4 space-y-3\">\r\n                    {/* Word with pronunciation buttons */}\r\n                    <div className=\"flex items-center gap-2 flex-wrap\">\r\n                      <span className=\"text-2xl font-bold text-gray-800\">\r\n                        {searchText}\r\n                      </span>\r\n                      \r\n                      {/* Pronunciation */}\r\n                      {pronunciation && (\r\n                        <span className=\"text-sm text-gray-600 font-mono bg-white px-2 py-1 rounded border border-gray-200\">\r\n                          {pronunciation}\r\n                        </span>\r\n                      )}\r\n                      \r\n                      {/* Part of Speech */}\r\n                      {partOfSpeech && (\r\n                        <span className=\"text-[10px] uppercase font-bold text-indigo-600 bg-indigo-100 border border-indigo-200 px-2 py-1 rounded\">\r\n                          {partOfSpeech}\r\n                        </span>\r\n                      )}\r\n                      \r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleSpeak(searchText, e);\r\n                        }}\r\n                        className=\"p-2 hover:bg-blue-100 rounded-full transition-colors\"\r\n                        title=\"Play pronunciation\"\r\n                      >\r\n                        ðŸ”Š\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleOpenAssessment({ \r\n                            id: 'temp', \r\n                            word: searchText,\r\n                            // userId: '',\r\n                            createdAt: new Date().toISOString(),\r\n                            updatedAt: new Date().toISOString(),\r\n                            occurrence: 0,\r\n                            isStarred: false,\r\n                            pronunciationScores: [],\r\n                          }, e);\r\n                        }}\r\n                        className=\"p-2 hover:bg-green-100 rounded-full transition-colors\"\r\n                        title=\"Test pronunciation\"\r\n                      >\r\n                        ðŸŽ¤\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Translation */}\r\n                    {isTranslating ? (\r\n                      <div className=\"text-sm text-gray-500 italic animate-pulse\">\r\n                        Loading...\r\n                      </div>\r\n                    ) : translation ? (\r\n                      <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\r\n                        <div className=\"text-xs text-gray-500 mb-1\">\r\n                          ðŸŒ Google Translate\r\n                        </div>\r\n                        <div className=\"text-base text-gray-800 font-medium\">\r\n                          {translation}\r\n                        </div>\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Create New Button */}\r\n              {searchText && !hasExactMatch && (\r\n                <div\r\n                  className=\"p-4 bg-indigo-50 border-b border-indigo-100 flex justify-between items-center group cursor-pointer hover:bg-indigo-100 transition-colors\"\r\n                  onClick={onCreate}\r\n                >\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-indigo-200 text-indigo-700 flex items-center justify-center font-bold text-xl\">\r\n                      +\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"font-bold text-indigo-800\">\r\n                        Create \"{searchText}\"\r\n                      </div>\r\n                      <div className=\"text-xs text-indigo-500\">\r\n                        Auto-fill meaning & pronunciation\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <span className=\"text-sm font-semibold text-indigo-600 bg-white px-3 py-1 rounded-full shadow-sm\">\r\n                    Enter â†µ\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {/* Results List */}\r\n              {results.length > 0 ? (\r\n                <ul className=\"divide-y divide-gray-100\">\r\n                  {results.map((item) => (\r\n                    <li\r\n                      key={item.id}\r\n                      onClick={() => {\r\n                        triggerInteraction(item);\r\n                        onSelect(item);\r\n                      }}\r\n                      className=\"p-3 hover:bg-indigo-50 cursor-pointer transition-colors group\"\r\n                    >\r\n                      <div className=\"flex justify-between items-start gap-3\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <span className=\"font-bold text-lg text-indigo-700\">\r\n                              {item.word}\r\n                            </span>\r\n                            \r\n                            {/* Actions nhá» trong list */}\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                handleOpenAssessment(item, e);\r\n                              }}\r\n                              className=\"text-gray-400 hover:text-green-600 p-1 rounded-full hover:bg-green-100\"\r\n                            >\r\n                              ðŸŽ¤\r\n                            </button>\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                handleSpeak(item.word, e);\r\n                              }}\r\n                              className=\"text-gray-400 hover:text-indigo-600 p-1 rounded-full hover:bg-indigo-100\"\r\n                            >\r\n                              ðŸ”Š\r\n                            </button>\r\n                            \r\n                            {item.partOfSpeech && (\r\n                              <span className=\"text-[10px] uppercase font-bold text-indigo-500 bg-indigo-50 border border-indigo-100 px-1.5 py-0.5 rounded\">\r\n                                {item.partOfSpeech}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"text-sm text-gray-800 line-clamp-2\">\r\n                            {item.meaning || <span className=\"italic text-gray-400\">No meaning</span>}\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/* Meta info bÃªn pháº£i */}\r\n                        <div className=\"text-right shrink-0 flex flex-col items-end gap-1\">\r\n                          {item.topic && (\r\n                            <span className=\"text-[10px] text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full\">\r\n                              {item.topic}\r\n                            </span>\r\n                          )}\r\n                          {item.isStarred && <span className=\"text-yellow-400 text-xs\">â˜…</span>}\r\n                        </div>\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              ) : (\r\n                !hasExactMatch &&\r\n                searchText && !translation && !isTranslating && (\r\n                  <div className=\"p-4 text-center text-gray-400 text-sm\">\r\n                    No existing words match.\r\n                  </div>\r\n                )\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2610, "column": 0}, "map": {"version":3,"sources":["file:///C:/code/c2025-12-09-worddd/apps/frontend/app/vocabulary/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useRef, useEffect, Suspense } from 'react';\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\n\r\nimport useVocabData from \"@/hooks/vocabulary/useVocabData\";\r\nimport useVocabModals from \"@/hooks/vocabulary/useVocabModals\";\r\n\r\nimport usePronunciationAssessment from \"@/hooks/vocabulary/usePronunciationAssessment\";\r\nimport useQuickSearch from \"@/hooks/vocabulary/useQuickSearch\";\r\n\r\nimport VocabTable from \"@/components/vocabulary/VocabTable\";\r\nimport VocabFormModal from \"@/components/vocabulary/VocabFormModal\";\r\nimport AssessmentModal from \"@/components/vocabulary/AssessmentModal\";\r\nimport QuickSearchModal from \"@/components/vocabulary/QuickSearchModal\";\r\nimport { StarIcon } from \"@/components/Icons\";\r\n\r\nfunction VocabularyContent() {\r\n  const { token, isLoading } = useAuth();\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Check if in iframe mode\r\n  const isIframeMode = searchParams.get(\"iframeMode\") === \"true\";\r\n\r\n  // QUAN TRá»ŒNG: Gá»i Táº¤T Cáº¢ hooks TRÆ¯á»šC khi cÃ³ báº¥t ká»³ return nÃ o\r\n  const {\r\n    vocabs,\r\n    loading,\r\n    page,\r\n    setPage,\r\n    totalPages,\r\n    showStarredOnly,\r\n    setShowStarredOnly,\r\n    filters,\r\n    sortConfig,\r\n    columnOrder,\r\n    draggedCol,\r\n    fetchVocabs,\r\n    handleFilterChange,\r\n    handleSort,\r\n    handleToggleStar,\r\n    triggerInteraction,\r\n    handleDragStart,\r\n    handleDragOver,\r\n    handleDragEnd,\r\n  } = useVocabData(token);\r\n\r\n  const {\r\n    selectedVocab,\r\n    isModalOpen,\r\n    setIsModalOpen,\r\n    isAutoFilling,\r\n    formData,\r\n    setFormData,\r\n    fileInputRef,\r\n    isUploading,\r\n    handleRowClick,\r\n    handleOpenCreateModal,\r\n    handleSave,\r\n    handleDelete,\r\n    handleFileChange,\r\n    fetchAutoFillData,\r\n  } = useVocabModals(token, () => fetchVocabs(page));\r\n\r\n  const {\r\n    isAssessmentModalOpen,\r\n    setIsAssessmentModalOpen,\r\n    recordingVocabItem,\r\n    isRecording,\r\n    assessmentResult,\r\n    assessmentError,\r\n    isProcessingAudio,\r\n    userAudioUrl,\r\n    startRecording,\r\n    stopRecording,\r\n    handleOpenAssessment,\r\n    handleSpeak,\r\n  } = usePronunciationAssessment(token, () => fetchVocabs(page), page);\r\n\r\n  const {\r\n    showSearch,\r\n    setShowSearch,\r\n    quickSearchText,\r\n    quickSearchResults,\r\n    isSearching,\r\n    searchInputRef,\r\n    hasExactMatch,\r\n    handleQuickSearchChange,\r\n  } = useQuickSearch(token, handleOpenCreateModal);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.code === \"Escape\") {\r\n        // Náº¿u Ä‘ang trong iframe mode, gá»­i message Ä‘á»ƒ Ä‘Ã³ng\r\n        if (isIframeMode) {\r\n          window.parent.postMessage(\"CLOSE_EXTENSION_IFRAME\", \"*\");\r\n        }\r\n        setShowSearch(false);\r\n        setIsModalOpen(false);\r\n        setIsAssessmentModalOpen(false);\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [setIsAssessmentModalOpen, setIsModalOpen, setShowSearch, isIframeMode]);\r\n\r\n  // Redirect to login if not authenticated (AFTER all hooks)\r\n  useEffect(() => {\r\n    if (!isLoading && !token) {\r\n      router.push(\"/login\");\r\n    }\r\n  }, [token, isLoading, router]);\r\n\r\n  // Hiá»ƒn thá»‹ loading khi Ä‘ang check auth\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Náº¿u khÃ´ng cÃ³ token sau khi load xong, Ä‘á»«ng render gÃ¬ (Ä‘ang redirect)\r\n  if (!token) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={`min-h-screen ${isIframeMode ? 'bg-transparent' : 'bg-gray-50'} p-6 text-black relative`}>\r\n      <AssessmentModal\r\n        isOpen={isAssessmentModalOpen}\r\n        onClose={() => setIsAssessmentModalOpen(false)}\r\n        vocabItem={recordingVocabItem}\r\n        isRecording={isRecording}\r\n        assessmentResult={assessmentResult}\r\n        assessmentError={assessmentError}\r\n        isProcessingAudio={isProcessingAudio}\r\n        userAudioUrl={userAudioUrl}\r\n        startRecording={startRecording}\r\n        stopRecording={stopRecording}\r\n        handleSpeak={handleSpeak}\r\n      />\r\n\r\n      <QuickSearchModal\r\n        isOpen={showSearch}\r\n        onClose={() => {\r\n          setShowSearch(false);\r\n          // Náº¿u Ä‘ang trong iframe mode vÃ  Ä‘Ã³ng search, thÃ¬ Ä‘Ã³ng cáº£ iframe\r\n          if (isIframeMode) {\r\n            window.parent.postMessage(\"CLOSE_EXTENSION_IFRAME\", \"*\");\r\n          }\r\n        }}\r\n        searchText={quickSearchText}\r\n        onSearchChange={handleQuickSearchChange}\r\n        results={quickSearchResults}\r\n        isSearching={isSearching}\r\n        onSelect={(vocab) => {\r\n          setShowSearch(false);\r\n          handleRowClick(vocab);\r\n        }}\r\n        onCreate={() => handleOpenCreateModal(quickSearchText)}\r\n        hasExactMatch={hasExactMatch}\r\n        searchInputRef={searchInputRef as React.RefObject<HTMLInputElement>}\r\n        handleSpeak={handleSpeak}\r\n        handleOpenAssessment={handleOpenAssessment}\r\n        triggerInteraction={triggerInteraction}\r\n      />\r\n\r\n      <VocabFormModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        initialData={formData}\r\n        setInitialData={setFormData}\r\n        isEditMode={!!selectedVocab}\r\n        onSave={handleSave}\r\n        onDelete={() => selectedVocab && handleDelete(selectedVocab.id)}\r\n        isAutoFilling={isAutoFilling}\r\n        fetchAutoFillData={fetchAutoFillData}\r\n        handleOpenAssessment={handleOpenAssessment}\r\n        handleSpeak={handleSpeak}\r\n        selectedVocab={selectedVocab}\r\n      />\r\n\r\n      {/* CHáº Y TRONG IFRAME MODE: Chá»‰ hiá»‡n QuickSearchModal, áº©n háº¿t pháº§n cÃ²n láº¡i */}\r\n      {isIframeMode ? (\r\n        <div className=\"flex items-center justify-center h-screen\">\r\n          <div className=\"text-gray-400 text-sm\">\r\n            {/* Placeholder - QuickSearchModal sáº½ tá»± Ä‘á»™ng má»Ÿ */}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* PAGE HEADER - CHá»ˆ HIá»†N KHI KHÃ”NG PHáº¢I IFRAME MODE */}\r\n          <div className=\"flex flex-col md:flex-row justify-between items-center mb-6 gap-4\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-800\">My Vocabulary</h1>\r\n              <p className=\"text-gray-500 text-sm mt-1\">\r\n                Double-tap{\" \"}\r\n                <kbd className=\"bg-gray-200 px-1.5 py-0.5 rounded text-xs border border-gray-300 font-mono\">\r\n                  Space\r\n                </kbd>{\" \"}\r\n                to Quick Search / Create\r\n              </p>\r\n            </div>\r\n            <div className=\"flex gap-2 items-center\">\r\n              <button\r\n                onClick={() => handleOpenCreateModal(\"\")}\r\n                className=\"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2 font-medium\"\r\n              >\r\n                <span>+</span> New Word\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  const newValue = !showStarredOnly;\r\n                  setShowStarredOnly(newValue);\r\n                  fetchVocabs(1, filters, sortConfig, newValue);\r\n                }}\r\n                className={`px-4 py-2 rounded-lg border flex items-center gap-2 transition-colors ${\r\n                  showStarredOnly\r\n                    ? \"bg-yellow-50 border-yellow-400 text-yellow-700\"\r\n                    : \"bg-white border-gray-300 text-gray-600\"\r\n                }`}\r\n              >\r\n                <StarIcon\r\n                  filled={showStarredOnly}\r\n                  className={showStarredOnly ? \"text-yellow-500\" : \"text-gray-400\"}\r\n                />\r\n                <span className=\"text-sm font-medium\">\r\n                  {showStarredOnly ? \"Starred\" : \"All\"}\r\n                </span>\r\n              </button>\r\n              <input\r\n                type=\"file\"\r\n                ref={fileInputRef}\r\n                onChange={handleFileChange}\r\n                accept=\".csv\"\r\n                className=\"hidden\"\r\n              />\r\n              <button\r\n                onClick={() => fileInputRef.current?.click()}\r\n                disabled={isUploading}\r\n                className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow flex items-center gap-2 text-sm font-medium\"\r\n              >\r\n                {isUploading ? \"...\" : \"ðŸ“‚ CSV\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <VocabTable\r\n            vocabs={vocabs}\r\n            loading={loading}\r\n            columnOrder={columnOrder}\r\n            draggedCol={draggedCol}\r\n            sortConfig={sortConfig}\r\n            filters={filters}\r\n            page={page}\r\n            totalPages={totalPages}\r\n            handleDragStart={handleDragStart}\r\n            handleDragOver={handleDragOver}\r\n            handleDragEnd={handleDragEnd}\r\n            handleSort={handleSort}\r\n            handleFilterChange={handleFilterChange}\r\n            handleRowClick={handleRowClick}\r\n            handleToggleStar={handleToggleStar}\r\n            handleOpenAssessment={handleOpenAssessment}\r\n            handleSpeak={handleSpeak}\r\n            triggerInteraction={triggerInteraction}\r\n            fetchVocabs={fetchVocabs}\r\n            setPage={setPage}\r\n          />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n// ... (Cuá»‘i file)\r\n\r\nexport default function VocabularyPage() {\r\n  return (\r\n    // Fallback lÃ  giao diá»‡n hiá»ƒn thá»‹ trong lÃºc chá» Ä‘á»c URL (thÆ°á»ng ráº¥t nhanh)\r\n    <Suspense fallback={<div className=\"p-4 text-center\">Loading vocabulary...</div>}>\r\n      <VocabularyContent />\r\n    </Suspense>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}